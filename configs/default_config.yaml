# configs/default_config.yaml
# Основные параметры проекта — декабрь 2025, один офис, без командировок

project:
  random_state: 42
  working_days:
    december: 22
    january: 16
    default: 22
  driving_hours_per_day: 5          # Реально до 5 часов в дороге (было 4)
  work_hours_per_day: 10            # Полный день с учётом обслуживания
  service_time_minutes: 30

# Кластеризация — ослабленные лимиты для высокого охвата
clustering:
  strategy: "capacitated_kmeans"
  n_clusters_per_manager:
    "0": 22
    "1": 22
    "2": 22
  max_visits_per_cluster: 25        # ← Было 12 → 25 (реальная нагрузка 20–25 визитов/день)
  max_points_per_cluster: 35        # ← Было 18 → 35
  min_points_per_cluster: 4         # ← Было 6 → можно меньше
  min_visits_per_cluster: 8
  max_diameter_km: 100              # ← Было 50 → 100 (Нижний + пригород)

  capacitated:
    enabled: true
    max_iterations: 300             # ← Было 100 → больше для агрессивного разбиения
    reassign_isolated: false        # ← Отключаем — изолированные не присоединять (чтобы не росли большие кластеры)
    split_large_clusters: true

# Отсеивание — агрессивнее, чтобы влезть в план
exclusion:
  enabled: true
  max_dist_from_depot_km: 80        # ← Было 200 → 80 км (реалистично для одного офиса)
  priority_reduce: true             # Сначала снижать повторные визиты
  max_exclusion_percent: 45         # ← Было 35 → до 45% (чтобы охват был высоким, но реалистичным)

# Маршрутизация — без командировок
routing:
  strategy: "ortools_vrp"
  use_split_route: false            # ← КОМАНДИРОВКИ ПОЛНОСТЬЮ ОТКЛЮЧЕНЫ
  api:
    ors_key: ${ORS_API_KEY}
    mode: "drive"
    driving_factor: 1.3               # ← Было 0.8 → 1.3 (реальные дороги длиннее)

  time:
    avg_speed_kmh: 40
    service_time_minutes: 30
    max_daily_hours: 10
    max_daily_distance_km: 250        # ← Было 160 → до ~6 часов в дороге

# Планирование расписания
scheduling:
  repeat_gap_days: 10               # ← Было 15 → 10 (больше места для повторных визитов)
  daily_distribution:
    target_visits_per_day: 22       # ← Было 12 → цель 22
    min_visits_per_day: 12
    max_visits_per_day: 25          # ← Было 12 → 25
  balancing:
    enabled: true
    max_load_difference_visits: 6   # ← Было 3 → больше гибкости

# Депо — одно общее, как требуется
depot:
  strategy: "single"
  single_location:
    lat: 56.321870
    lon: 43.946066
    name: "Офис — Московский вокзал (Нижний Новгород)"

# Вывод результатов
output:
  directories:
    base_dir: ./outputs
    maps: ${output.directories.base_dir}/maps
    reports: ${output.directories.base_dir}/reports
    data: ${output.directories.base_dir}/data
    logs: ${output.directories.base_dir}/logs
    yandex_links: ${output.directories.base_dir}/yandex_routes_links.xlsx

  visualization:
    save_maps: true
    generate_report: true
    yandex_links: true
    map_provider: "OpenStreetMap"
    map_zoom: 11
    cluster_colors: "viridis"
    missed_points_color: "red"
    visited_once_color: "orange"

# Логирование
logging:
  level: "INFO"
  file: ${output.directories.logs}/geoplanner.log